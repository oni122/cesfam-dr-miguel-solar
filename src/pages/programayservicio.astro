---
import Layout from '../layouts/Layout.astro';
import { supabase } from '../lib/supabaseclient';

let programas = [];

try {
  const { data, error } = await supabase
    .from('programa')
    .select('id_programa, nombre, servicios(id_servicio, nombre, id_programa)');

  if (error) {
    console.error('Error Supabase:', error);
  } else {
    programas = data;
  }
} catch (e) {
  console.error('Error cargando programas:', e);
}
---

<Layout title="Programas y Servicios">
  <h1 class="text-2xl font-bold mb-4">Programas y Servicios</h1>

  <div class="space-y-6">
    {programas.length
      ? programas.map(programa => (
          <div class="p-4 border rounded-lg shadow-sm bg-white">
            <h2 class="text-xl font-semibold">{programa.nombre}</h2>
            <ul class="list-disc ml-6 mt-2">
              {programa.servicios?.length
                ? programa.servicios.map(servicio => (
                    <li>{servicio.nombre}</li>
                  ))
                : <li>No hay servicios disponibles</li>
              }
            </ul>
          </div>
        ))
      : <p>No hay programas disponibles.</p>
    }
  </div>
</Layout>
